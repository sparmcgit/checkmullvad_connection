#!/bin/bash
# Program to check that mullvad is in use
# Martin Häggström 180908
# restart by sudo systemctl restart openvpn@mullvad_se.service

MULLVAD_DNS_SERVER=193.138.218.169
MULLVAD_COUNTRY=Sweden
MULLVAD_BLACKLISTED=false
TIMEOUT=3
CURL_COMMAND="curl -m $TIMEOUT -s"
MULLVAD_URL=https://am.i.mullvad.net

# first check that TIMEOUT is not exceeded
COUNTRY=`${CURL_COMMAND} ${MULLVAD_URL}/country`

if [ "${COUNTRY}" != "$MULLVAD_COUNTRY" ]
then
	echo "mullvad_is_not_working COUNTRY:${COUNTRY}" | wall
fi

BLACKLISTED=`${CURL_COMMAND} ${MULLVAD_URL}/json | jq .blacklisted.blacklisted`
if [ "$BLACKLISTED" != "$MULLVAD_BLACKLISTED" ]
then
	echo "mullvad_is_not_working BLACKLISTED:${BLACKLISTED}" | wall
fi
